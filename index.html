<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KURS REALTIME - MINAS</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { background-color: #0d1117; color: white; font-family: sans-serif; }
        .card { background: #161b22; border-radius: 12px; padding: 15px; margin-bottom: 10px; border: 1px solid #30363d; }
        .up { color: #26a69a; }
        .down { color: #ef5350; }
        .logo-img { width: 24px; height: 24px; border-radius: 50%; margin-right: 10px; background: #30363d; }
    </style>
</head>
<body class="p-4">

    <h2 class="text-xl font-bold mb-4 text-center">Crypto Real-time (IDR)</h2>
    <div id="crypto-container">
        <p class="text-center text-gray-400">Loading data...</p>
    </div>

    <script>
        // --- LOGIKA FALLBACK LOGO (Sesuai Permintaan Lu) ---
        function getInitialLogo(symbol) {
            // Step 1: Nyoba ke Binance dulu
            return `https://binance-docs.github.io/apidocs/spot/en/img/logos/${symbol.toLowerCase()}.png`;
        }

        function handleLogoError(img, symbol) {
            const coin = symbol.toLowerCase();
            const upperCoin = symbol.toUpperCase();
            
            // Urutan Fetchall: Bybit -> MEXC -> Gate -> CryptoIcons -> Placeholder
            const fallbacks = [
                `https://www.bybit.com/bybit-icons/coin/${upperCoin}.png`,
                `https://www.mexc.com/static/coin/${upperCoin}.png`,
                `https://gate.io/images/coin_icon/64/${coin}.png`,
                `https://cryptoicons.org/api/color/${coin}/400`,
                `https://via.placeholder.com/32?text=${upperCoin}`
            ];

            let currentIndex = parseInt(img.getAttribute('data-fallback-index') || 0);

            if (currentIndex < fallbacks.length) {
                img.src = fallbacks[currentIndex];
                img.setAttribute('data-fallback-index', currentIndex + 1);
            } else {
                img.onerror = null; // Biar ga looping terus kalo semua gagal
            }
        }
        // --------------------------------------------------

        async function fetchCryptoData() {
            try {
                const response = await fetch('https://api.coingecko.com/api/v3/coins/markets?vs_currency=idr&order=market_cap_desc&per_page=20&page=1&sparkline=false');
                const data = await response.json();
                renderTable(data);
            } catch (error) {
                console.error("Gagal ambil data:", error);
            }
        }

        function renderTable(data) {
            const container = document.getElementById('crypto-container');
            container.innerHTML = "";

            data.forEach(item => {
                const priceChange = item.price_change_percentage_24h.toFixed(2);
                const colorClass = priceChange >= 0 ? 'up' : 'down';
                const sign = priceChange >= 0 ? '+' : '';

                const card = `
                    <div class="card flex justify-between items-center">
                        <div class="flex items-center">
                            <img src="${getInitialLogo(item.symbol)}" 
                                 onerror="handleLogoError(this, '${item.symbol}')" 
                                 class="logo-img" 
                                 alt="${item.symbol}">
                            <div>
                                <div class="font-bold">${item.name}</div>
                                <div class="text-sm text-gray-400">${item.symbol.toUpperCase()}</div>
                            </div>
                        </div>
                        <div class="text-right">
                            <div class="font-bold">Rp ${item.current_price.toLocaleString('id-ID')}</div>
                            <div class="${colorClass} text-sm">${sign}${priceChange}%</div>
                        </div>
                    </div>
                `;
                container.innerHTML += card;
            });
        }

        fetchCryptoData();
        setInterval(fetchCryptoData, 30000); // Update tiap 30 detik
    </script>
</body>
</html>
